"use strict";var AngularFire;angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(a,b,c){return function(d,e,f,g){var h=new AngularFire(a,b,c,d);return h.associate(e,f,g)}}]),AngularFire=function(a,b,c,d){this._q=a,this._parse=b,this._timeout=c,this._initial=!0,this._remoteValue=!1,this._fRef="string"==typeof d?new Firebase(d):d},AngularFire.prototype={associate:function(a,b,c){var d=this;void 0===c&&(c=[]);var e=this._q.defer(),f=e.promise;return this._fRef.on("value",function(f){var g=!1;if(e&&(g=e,e=!1),d._remoteValue=c,f&&f.val()){var h=f.val();if(typeof h!=typeof c)return d._log("Error: type mismatch"),void 0;var i=Object.prototype.toString;if(i.call(c)!=i.call(h))return d._log("Error: type mismatch"),void 0;if(d._remoteValue=angular.copy(h),angular.equals(h,d._parse(b)(a)))return}d._timeout(function(){d._resolve(a,b,g,d._remoteValue)})}),f},disassociate:function(){var a=this;a._unregister&&a._unregister(),this._fRef.off("value")},_resolve:function(a,b,c,d){var e=this;this._parse(b).assign(a,angular.copy(d)),this._remoteValue=angular.copy(d),c&&(c.resolve(function(){e.disassociate()}),this._watch(a,b))},_watch:function(a,b){var c=this;c._unregister=a.$watch(b,function(){if(c._initial)return c._initial=!1,void 0;var d=JSON.parse(angular.toJson(c._parse(b)(a)));angular.equals(d,c._remoteValue)||c._fRef.ref().set(d)},!0),a.$on("$destroy",function(){c.disassociate()})},_log:function(a){console&&console.log&&console.log(a)}},angular.module("firebase").factory("angularFireCollection",["$timeout",function(a){return function(b,c){function d(a){return a?m[a]+1:0}function e(a,b){m[b.$id]=a,n.splice(a,0,b)}function f(a){var b=m[a];n.splice(b,1),m[a]=void 0}function g(a,b){n[a]=b}function h(a,b,c){n.splice(a,1),n.splice(b,0,c),i(a,b)}function i(a,b){var c=n.length;b=b||c,b>c&&(b=c);for(var d=a;b>d;d++){var e=n[d];e.$index=m[e.$id]=d}}var j,k=function(a,b){this.$ref=a.ref(),this.$id=a.name(),this.$index=b,angular.extend(this,{priority:a.getPriority()},a.val())},l=[function(a){return null==a.$priority?0:angular.isNumber(a.$priority)?1:angular.isString(a.$priority)?2:void 0},function(a){return a.$priority?a.$priority:1/0},function(a){return a.$id}],m={},n=[];return j="string"==typeof b?new Firebase(b):b,c&&"function"==typeof c&&j.once("value",c),j.on("child_added",function(b,c){a(function(){var a=d(c);e(a,new k(b,a)),i(a)})}),j.on("child_removed",function(b){a(function(){var a=b.name(),c=m[a];f(a),i(c)})}),j.on("child_changed",function(b,c){a(function(){var a=m[b.name()],e=d(c),f=new k(b,a);g(a,f),e!==a&&h(a,e,f)})}),j.on("child_moved",function(b,c){a(function(){var a=m[b.name()],e=d(c),f=n[a];h(a,e,f)})}),n.getByName=function(a){return n[m[a]]},n.add=function(a,b){var c;return c=b?j.ref().push(a,b):j.ref().push(a)},n.remove=function(a,b){var c=angular.isString(a)?n[m[a]]:a;b?c.$ref.remove(b):c.$ref.remove()},n.update=function(a,b){var c=angular.isString(a)?n[m[a]]:a,d={};angular.forEach(c,function(a,b){0!==b.indexOf("$")&&(d[b]=a)}),b?c.$ref.set(d,b):c.$ref.set(d)},n.order=l,n}}]),angular.module("firebase").factory("angularFireAuth",["$rootScope","$parse","$timeout","$location","$route","$q",function(a,b,c,d,e,f){function g(a){var b=a.split(".");if(!b instanceof Array||3!==b.length)throw new Error("Invalid JWT");var c=b[1];return JSON.parse(decodeURIComponent(escape(window.atob(c))))}function h(a,d,e,f){d&&c(function(){b(d).assign(a,e),f()})}function i(a,b,c){a.authRequired&&!c._authenticated&&(c._redirectTo=void 0===a.pathTo?d.path():a.pathTo===b?"/":a.pathTo,d.replace(),d.path(b))}return{initialize:function(b,c){var d=this;if(c=c||{},this._scope=a,c.scope&&(this._scope=c.scope),c.name&&(this._name=c.name),this._cb=function(){},c.callback&&"function"==typeof c.callback&&(this._cb=c.callback),this._redirectTo=null,this._authenticated=!1,c.path&&(e.current&&i(e.current,c.path,d),a.$on("$routeChangeStart",function(a,b){i(b,c.path,d)})),this._ref=new Firebase(b),c.simple&&c.simple===!1)return h(this._scope,this._name,null),void 0;if(!window.FirebaseSimpleLogin){var f=new Error("FirebaseSimpleLogin undefined, did you include firebase-simple-login.js?");return a.$broadcast("angularFireAuth:error",f),void 0}var g=new FirebaseSimpleLogin(this._ref,function(b,c){d._cb(b,c),b?a.$broadcast("angularFireAuth:error",b):c?d._loggedIn(c):d._loggedOut()});this._authClient=g},login:function(b,c){var d=this._watchForLogin();switch(b){case"github":case"persona":case"twitter":case"facebook":case"password":if(this._authClient)this._authClient.login(b,c);else{var e=new Error("Simple Login not initialized");a.$broadcast("angularFireAuth:error",e)}break;default:var f,h=this;try{f=g(b),this._ref.auth(b,function(b){b?a.$broadcast("angularFireAuth:error",b):h._loggedIn(f)})}catch(i){a.$broadcast("angularFireAuth:error",i)}}return d},createUser:function(b,d,e){var f=this;this._authClient.createUser(b,d,function(b,d){try{b?a.$broadcast("angularFireAuth:error",b):f._loggedIn(d)}catch(g){a.$broadcast("angularFireAuth:error",g)}e&&c(function(){e(d)})})},logout:function(){this._authClient?this._authClient.logout():(this._ref.unauth(),this._loggedOut())},_loggedIn:function(b){var c=this;this._authenticated=!0,h(this._scope,this._name,b,function(){a.$broadcast("angularFireAuth:login",b),c._redirectTo&&(d.replace(),d.path(c._redirectTo),c._redirectTo=null)})},_loggedOut:function(){this._authenticated=!1,h(this._scope,this._name,null,function(){a.$broadcast("angularFireAuth:logout")})},_watchForLogin:function(){function b(a,b){c(function(){a?e.reject(a):e.resolve(b)});for(var f=0;f<d.length;f++)d[f]()}var d=[],e=f.defer();return d.push(a.$on("angularFireAuth:login",function(a,c){b(null,c)})),d.push(a.$on("angularFireAuth:error",function(a,c){b(c,null)})),e.promise}}}]);