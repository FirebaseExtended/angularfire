"use strict";function AngularFire(t,e,i,n){this._q=t,this._parse=e,this._timeout=i,this._initial=!0,this._remoteValue=!1,this._fRef="string"==typeof n?new Firebase(n):n}angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(t,e,i){return function(n,r,a,o){var u=new AngularFire(t,e,i,n);return u.associate(r,a,o)}}]),AngularFire.prototype={disassociate:function(){var t=this;t._unregister&&t._unregister(),this._fRef.off("value")},associate:function(t,e,i){var n=this;void 0==i&&(i=[]);var r=this._q.defer(),a=r.promise;return this._fRef.on("value",function(a){var o=!1;if(r&&(o=r,r=!1),n._remoteValue=i,a&&void 0!=a.val()){var u=a.val();if(typeof u!=typeof i)return n._log("Error: type mismatch"),void 0;var s=Object.prototype.toString;if(s.call(i)!=s.call(u))return n._log("Error: type mismatch"),void 0;if(n._remoteValue=angular.copy(u),angular.equals(u,n._parse(e)(t)))return}n._timeout(function(){n._resolve(t,e,o,n._remoteValue)})}),a},_log:function(t){console&&console.log&&console.log(t)},_resolve:function(t,e,i,n){var r=this;this._parse(e).assign(t,angular.copy(n)),this._remoteValue=angular.copy(n),i&&(i.resolve(function(){r.disassociate()}),this._watch(t,e))},_watch:function(t,e){var i=this;i._unregister=t.$watch(e,function(){if(i._initial)return i._initial=!1,void 0;var n=JSON.parse(angular.toJson(i._parse(e)(t)));angular.equals(n,i._remoteValue)||i._fRef.ref().set(n)},!0)}},angular.module("firebase").factory("angularFireCollection",["$timeout",function(t){function e(t,e){this.$ref=t.ref(),this.$id=t.name(),this.$index=e,angular.extend(this,{priority:t.getPriority()},t.val())}return function(i,n){function r(t){return t?h[t]+1:0}function a(t,e){h[e.$id]=t,f.splice(t,0,e)}function o(t){var e=h[t];f.splice(e,1),h[t]=void 0}function u(t,e){f[t]=e}function s(t,e,i){f.splice(t,1),f.splice(e,0,i),c(t,e)}function c(t,e){var i=f.length;e=e||i,e>i&&(e=i);for(var n=t;e>n;n++){var r=f[n];r.$index=h[r.$id]=n}}var l,f=[],h={};return l="string"==typeof i?new Firebase(i):i,n&&"function"==typeof n&&l.once("value",n),l.on("child_added",function(i,n){t(function(){var t=r(n);a(t,new e(i,t)),c(t)})}),l.on("child_removed",function(e){t(function(){var t=e.name(),i=h[t];o(t),c(i)})}),l.on("child_changed",function(i,n){t(function(){var t=h[i.name()],a=r(n),o=new e(i,t);u(t,o),a!==t&&s(t,a,o)})}),l.on("child_moved",function(e,i){t(function(){var t=h[e.name()],n=r(i),a=f[t];s(t,n,a)})}),f.add=function(t,e){var i;return i=e?l.ref().push(t,e):l.ref().push(t)},f.remove=function(t){var e=angular.isString(t)?f[h[t]]:t;e.$ref.remove()},f.update=function(t){var e=angular.isString(t)?f[h[t]]:t,i={};angular.forEach(e,function(t,e){0!==e.indexOf("$")&&(i[e]=t)}),e.$ref.set(i)},f}}]),angular.module("firebase").factory("angularFireAuth",["$rootScope","$parse","$timeout","$location",function(t,e,i,n){function r(t){var e=t.split(".");if(!e instanceof Array||3!==e.length)throw new Error("Invalid JWT");var i=e[1];return JSON.parse(decodeURIComponent(escape(window.atob(i))))}function a(t,n,r,a){n&&i(function(){e(n).assign(t,r),a()})}return{initialize:function(e,i){var r=this;if(i=i||{},this._scope=t,i.scope&&(this._scope=i.scope),i.name&&(this._name=i.name),this._cb=function(){},i.callback&&"function"==typeof i.callback&&(this._cb=i.callback),this._redirectTo=null,this._authenticated=!1,i.path&&t.$on("$routeChangeStart",function(t,e){e.authRequired&&!r._authenticated&&(r._redirectTo=void 0===e.pathTo?n.path():e.pathTo===i.path?"/":e.pathTo,n.path(i.path))}),this._ref=new Firebase(e),i.simple&&i.simple===!1)return a(this._scope,this._name,null),void 0;if(!window.FirebaseAuthClient){var o=new Error("FirebaseAuthClient undefined, did you include firebase-auth-client.js?");return t.$broadcast("angularFireAuth:error",o),void 0}var u=new FirebaseAuthClient(this._ref,function(e,i){r._cb(e,i),e?t.$broadcast("angularFireAuth:error",e):i?r._loggedIn(i):r._loggedOut()});this._authClient=u},login:function(e,i){switch(e){case"github":case"persona":case"twitter":case"facebook":case"password":if(this._authClient)this._authClient.login(e,i);else{var n=new Error("Simple Login not initialized");t.$broadcast("angularFireAuth:error",n)}break;default:var a,o=this;try{a=r(e),this._ref.auth(e,function(e){e?t.$broadcast("angularFireAuth:error",e):o._loggedIn()})}catch(u){t.$broadcast("angularFireAuth:error",u)}}},logout:function(){this._authClient?this._authClient.logout():(this._ref.unauth(),this._loggedOut())},_loggedIn:function(e){var i=this;this._authenticated=!0,a(this._scope,this._name,e,function(){t.$broadcast("angularFireAuth:login",e),i._redirectTo&&(n.path(i._redirectTo),i._redirectTo=null)})},_loggedOut:function(){this._authenticated=!1,a(this._scope,this._name,null,function(){t.$broadcast("angularFireAuth:logout")})}}}]);