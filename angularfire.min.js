// AngularFire is an officially supported AngularJS binding for Firebase.
// The bindings let you associate a Firebase URL with a model (or set of
// models), and they will be transparently kept in sync across all clients
// currently using your app. The 2-way data binding offered by AngularJS works
// as normal, except that the changes are also sent to all other clients
// instead of just a server.
//
//      AngularFire 0.3
//      http://angularfire.com
//      License: MIT
"use strict";var AngularFire;angular.module("firebase",[]).value("Firebase",Firebase);angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(e,t,n){return function(r,i,s){var o=new AngularFire(e,t,n,r);return o.associate(i,s)}}]);AngularFire=function(e,t,n,r){this._q=e;this._parse=t;this._timeout=n;this._initial=!0;this._remoteValue=!1;if(typeof r=="string")throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=r};AngularFire.prototype={associate:function(e,t){var n=this,r=this._q.defer(),i=r.promise;this._fRef.on("child_added",function(r){if(typeof e[t]=="undefined"){var i=e[t],s=Object.prototype.toString,o;s.call(i)==s.call([])?o=[]:o={};n._parse(t).assign(e,o)}var u=t+"['"+r.name()+"']";n._parse(u).assign(e,r.val())});this._fRef.on("child_changed",function(r){var i=t+"['"+r.name()+"']";n._parse(i).assign(e,r.val())});this._fRef.on("child_removed",function(n){delete e[t][n.name()]});this._fRef.once("value",function(i){var s=i.val(),o=angular.fromJson(angular.toJson(n._parse(t)(e)));if(n._initial){n._initial=!1;var u=!1,a=Object.prototype.toString;if(s&&a.call(o)==a.call(s))if(a.call(o)=="[object Array]"){u=o.concat(s);if(!angular.equals(u,s)){n._fRef.ref().set(u);s=u}}else if(a.call(o)=="[object Object]"){u=o;for(var f in s)u[f]=s[f];n._fRef.ref().update(u);s=u}if(s===null&&o!==undefined){n._fRef.ref().set(o);s=o}}typeof s!="object"&&n._parse(t).assign(e,s);n._timeout(function(){if(r){r.resolve(function(){n.disassociate()});n._watch(e,t);r=!1}})});return i},disassociate:function(){var e=this;e._unregister&&e._unregister();this._fRef.off("value")},_watch:function(e,t){var n=this;n._unregister=e.$watch(t,function(){if(n._initial)return;var r=angular.fromJson(angular.toJson(n._parse(t)(e)));if(angular.equals(r,n._remoteValue))return;var i=Object.prototype.toString;i.call(r)=="[object Object]"?n._fRef.set?n._fRef.set(r):n._fRef.ref().update(r):n._fRef.ref().set(r)},!0);e.$on("$destroy",function(){n.disassociate()})},_log:function(e){console&&console.log&&console.log(e)}};angular.module("firebase").factory("angularFireCollection",["$timeout",function(e){return function(t,n){function u(e){return e?s[e]+1:0}function a(e,t){s[t.$id]=e;o.splice(e,0,t)}function f(e){var t=s[e];o.splice(t,1);s[e]=undefined}function l(e,t){o[e]=t}function c(e,t,n){o.splice(e,1);o.splice(t,0,n);h(e,t)}function h(e,t){var n=o.length;t=t||n;t>n&&(t=n);for(var r=e;r<t;r++){var i=o[r];i.$index=s[i.$id]=r}}if(typeof t=="string")throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");var r=function(e,t){this.$ref=e.ref();this.$id=e.name();this.$index=t;angular.extend(this,{$priority:e.getPriority()},e.val())},i=[function(e){if(e.$priority==null)return 0;if(angular.isNumber(e.$priority))return 1;if(angular.isString(e.$priority))return 2},function(e){return e.$priority?e.$priority:Infinity},function(e){return e.$id}],s={},o=[];n&&typeof n=="function"&&t.once("value",n);t.on("child_added",function(t,n){e(function(){var e=u(n);a(e,new r(t,e));h(e)})});t.on("child_removed",function(t){e(function(){var e=t.name(),n=s[e];f(e);h(n)})});t.on("child_changed",function(t,n){e(function(){var e=s[t.name()],i=u(n),o=new r(t,e);l(e,o);i!==e&&c(e,i,o)})});t.on("child_moved",function(t,n){e(function(){var e=s[t.name()],r=u(n),i=o[e];c(e,r,i)})});o.getByName=function(e){return o[s[e]]};o.getByNames=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(o[s[e[n]]]);return t};o.add=function(e,n){var r,i=angular.fromJson(angular.toJson(e));n?r=t.ref().push(i,n):r=t.ref().push(i);return r};o.remove=function(e,t){var n=angular.isString(e)?o[s[e]]:e;t?n.$ref.remove(t):n.$ref.remove()};o.update=function(e,t){var n=angular.isString(e)?o[s[e]]:e,r=angular.fromJson(angular.toJson(n));t?n.$ref.update(r,t):n.$ref.update(r)};o.set=function(e,t){var n=angular.isString(e)?o[s[e]]:e,r=angular.fromJson(angular.toJson(n));t?n.$ref.set(r,t):n.$ref.set(r)};o.order=i;return o}}]);angular.module("firebase").factory("angularFireAuth",["$rootScope","$parse","$timeout","$location","$route","$q",function(e,t,n,r,i,s){function o(e){var t=e.split(".");if(!t instanceof Array||t.length!==3)throw new Error("Invalid JWT");var n=t[1];return window.atob?JSON.parse(decodeURIComponent(escape(window.atob(n)))):e}function u(e,r,i,s){r&&n(function(){t(r).assign(e,i);s()})}function a(e,t,n){if(e.authRequired&&!n._authenticated){e.pathTo===undefined?n._redirectTo=r.path():n._redirectTo=e.pathTo===t?"/":e.pathTo;r.replace();r.path(t)}}return{initialize:function(t,n){var r=this;if(typeof t=="string")throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");n=n||{};this._scope=e;if(!n.scope)throw new Error("Scope not provided to angularFireAuth!");this._scope=n.scope;if(!n.name)throw new Error("Model name not provided to angularFireAuth!");this._name=n.name;this._cb=function(){};n.callback&&typeof n.callback=="function"&&(this._cb=n.callback);this._redirectTo=null;this._authenticated=!1;if(n.path){i.current&&a(i.current,n.path,r);e.$on("$routeChangeStart",function(e,t){a(t,n.path,r)})}this._ref=t;if(n.simple===!1){u(this._scope,this._name,null,function(){});return}if(!window.FirebaseSimpleLogin){var s=new Error("FirebaseSimpleLogin undefined, did you include firebase-simple-login.js?");e.$broadcast("angularFireAuth:error",s);return}var o=new FirebaseSimpleLogin(this._ref,function(t,n){r._cb(t,n);t?e.$broadcast("angularFireAuth:error",t):n?r._loggedIn(n):r._loggedOut()});this._authClient=o},login:function(t,n){var r=this._watchForLogin();switch(t){case"github":case"persona":case"twitter":case"facebook":case"password":if(!this._authClient){var i=new Error("Simple Login not initialized");e.$broadcast("angularFireAuth:error",i)}else this._authClient.login(t,n);break;default:var s,u=this;try{s=o(t);this._ref.auth(t,function(t){t?e.$broadcast("angularFireAuth:error",t):u._loggedIn(s)})}catch(a){e.$broadcast("angularFireAuth:error",a)}}return r},createUser:function(t,r,i,s){var o=this;this._authClient.createUser(t,r,function(u,a){try{u?e.$broadcast("angularFireAuth:error",u):s||o.login("password",{email:t,password:r})}catch(f){e.$broadcast("angularFireAuth:error",f)}i&&n(function(){i(u,a)})})},logout:function(){if(this._authClient)this._authClient.logout();else{this._ref.unauth();this._loggedOut()}},_loggedIn:function(t){var n=this;this._authenticated=!0;u(this._scope,this._name,t,function(){e.$broadcast("angularFireAuth:login",t);if(n._redirectTo){r.replace();r.path(n._redirectTo);n._redirectTo=null}})},_loggedOut:function(){this._authenticated=!1;u(this._scope,this._name,null,function(){e.$broadcast("angularFireAuth:logout")})},_watchForLogin:function(){function i(e,i){n(function(){e?r.reject(e):r.resolve(i)});for(var s=0;s<t.length;s++)t[s]()}var t=[],r=s.defer();t.push(e.$on("angularFireAuth:login",function(e,t){i(null,t)}));t.push(e.$on("angularFireAuth:error",function(e,t){i(t,null)}));return r.promise}}}]);