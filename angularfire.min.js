// AngularFire is an officially supported AngularJS binding for Firebase.
// The bindings let you associate a Firebase URL with a model (or set of
// models), and they will be transparently kept in sync across all clients
// currently using your app. The 2-way data binding offered by AngularJS works
// as normal, except that the changes are also sent to all other clients
// instead of just a server.
//
//      AngularFire 0.3
//      http://angularfire.com
//      License: MIT
"use strict";function AngularFire(e,t,n,r){this._q=e;this._parse=t;this._timeout=n;this._initial=!0;this._remoteValue=!1;typeof r=="string"?this._fRef=new Firebase(r):this._fRef=r}angular.module("firebase",[]).value("Firebase",Firebase);angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(e,t,n){return function(r,i,s,o){var u=new AngularFire(e,t,n,r);return u.associate(i,s,o)}}]);AngularFire.prototype={associate:function(e,t,n){var r=this;n==undefined&&(n=[]);var i=this._q.defer(),s=i.promise;this._fRef.on("value",function(s){var o=!1;if(i){o=i;i=!1}r._remoteValue=n;if(s&&s.val()!=undefined){var u=s.val();if(typeof u!=typeof n){r._log("Error: type mismatch");return}var a=Object.prototype.toString;if(a.call(n)!=a.call(u)){r._log("Error: type mismatch");return}r._remoteValue=angular.copy(u);if(angular.equals(u,r._parse(t)(e)))return}r._timeout(function(){r._resolve(e,t,o,r._remoteValue)})});return s},disassociate:function(){var e=this;e._unregister&&e._unregister();this._fRef.off("value")},_resolve:function(e,t,n,r){var i=this;this._parse(t).assign(e,angular.copy(r));this._remoteValue=angular.copy(r);if(n){n.resolve(function(){i.disassociate()});this._watch(e,t)}},_watch:function(e,t){var n=this;n._unregister=e.$watch(t,function(){if(n._initial){n._initial=!1;return}var r=JSON.parse(angular.toJson(n._parse(t)(e)));if(angular.equals(r,n._remoteValue))return;n._fRef.ref().set(r)},!0);e.$on("$destroy",function(){n.disassociate()})},_log:function(e){console&&console.log&&console.log(e)}};angular.module("firebase").factory("angularFireCollection",["$timeout",function(e){return function(t,n){function r(e,t){this.$ref=e.ref();this.$id=e.name();this.$index=t;angular.extend(this,{priority:e.getPriority()},e.val())}function a(e){return e?s[e]+1:0}function f(e,t){s[t.$id]=e;o.splice(e,0,t)}function l(e){var t=s[e];o.splice(t,1);s[e]=undefined}function c(e,t){o[e]=t}function h(e,t,n){o.splice(e,1);o.splice(t,0,n);p(e,t)}function p(e,t){var n=o.length;t=t||n;t>n&&(t=n);for(var r=e;r<t;r++){var i=o[r];i.$index=s[i.$id]=r}}var i=[function(e){if(e.$priority==null)return 0;if(angular.isNumber(e.$priority))return 1;if(angular.isString(e.$priority))return 2},function(e){return e.$priority?e.$priority:Infinity},function(e){return e.$id}],s={},o=[],u;typeof t=="string"?u=new Firebase(t):u=t;n&&typeof n=="function"&&u.once("value",n);u.on("child_added",function(t,n){e(function(){var e=a(n);f(e,new r(t,e));p(e)})});u.on("child_removed",function(t){e(function(){var e=t.name(),n=s[e];l(e);p(n)})});u.on("child_changed",function(t,n){e(function(){var e=s[t.name()],i=a(n),o=new r(t,e);c(e,o);i!==e&&h(e,i,o)})});u.on("child_moved",function(t,n){e(function(){var e=s[t.name()],r=a(n),i=o[e];h(e,r,i)})});o.getByName=function(e){return o[s[e]]};o.getByNames=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(o[s[e[n]]]);return t};o.add=function(e,t){var n;t?n=u.ref().push(e,t):n=u.ref().push(e);return n};o.remove=function(e,t){var n=angular.isString(e)?o[s[e]]:e;t?n.$ref.remove(t):n.$ref.remove()};o.update=function(e,t){var n=angular.isString(e)?o[s[e]]:e,r={};angular.forEach(n,function(e,t){t.indexOf("$")!==0&&(r[t]=e)});t?n.$ref.set(r,t):n.$ref.set(r)};o.order=i;return o}}]);angular.module("firebase").factory("angularFireAuth",["$rootScope","$parse","$timeout","$location","$route","$q",function(e,t,n,r,i,s){function o(e){var t=e.split(".");if(!t instanceof Array||t.length!==3)throw new Error("Invalid JWT");var n=t[1];return JSON.parse(decodeURIComponent(escape(window.atob(n))))}function u(e,r,i,s){r&&n(function(){t(r).assign(e,i);s()})}function a(e,t,n){if(e.authRequired&&!n._authenticated){e.pathTo===undefined?n._redirectTo=r.path():n._redirectTo=e.pathTo===t?"/":e.pathTo;r.replace();r.path(t)}}return{initialize:function(t,n){var r=this;n=n||{};this._scope=e;n.scope&&(this._scope=n.scope);n.name&&(this._name=n.name);this._cb=function(){};n.callback&&typeof n.callback=="function"&&(this._cb=n.callback);this._redirectTo=null;this._authenticated=!1;if(n.path){i.current&&a(i.current,n.path,r);e.$on("$routeChangeStart",function(e,t){a(t,n.path,r)})}this._ref=new Firebase(t);if(n.simple&&n.simple===!1){u(this._scope,this._name,null);return}if(!window.FirebaseSimpleLogin){var s=new Error("FirebaseSimpleLogin undefined, did you include firebase-simple-login.js?");e.$broadcast("angularFireAuth:error",s);return}var o=new FirebaseSimpleLogin(this._ref,function(t,n){r._cb(t,n);t?e.$broadcast("angularFireAuth:error",t):n?r._loggedIn(n):r._loggedOut()});this._authClient=o},login:function(t,n){var r=this._watchForLogin();switch(t){case"github":case"persona":case"twitter":case"facebook":case"password":if(!this._authClient){var i=new Error("Simple Login not initialized");e.$broadcast("angularFireAuth:error",i)}else this._authClient.login(t,n);break;default:var s,u=this;try{s=o(t);this._ref.auth(t,function(t){t?e.$broadcast("angularFireAuth:error",t):u._loggedIn(s)})}catch(a){e.$broadcast("angularFireAuth:error",a)}}return r},createUser:function(t,r,i){var s=this;this._authClient.createUser(t,r,function(t,r){try{t?e.$broadcast("angularFireAuth:error",t):s._loggedIn(r)}catch(o){e.$broadcast("angularFireAuth:error",o)}i&&n(function(){i(r)})})},logout:function(){if(this._authClient)this._authClient.logout();else{this._ref.unauth();this._loggedOut()}},_loggedIn:function(t){var n=this;this._authenticated=!0;u(this._scope,this._name,t,function(){e.$broadcast("angularFireAuth:login",t);if(n._redirectTo){r.replace();r.path(n._redirectTo);n._redirectTo=null}})},_loggedOut:function(){this._authenticated=!1;u(this._scope,this._name,null,function(){e.$broadcast("angularFireAuth:logout")})},_watchForLogin:function(){function i(e,i){n(function(){e?r.reject(e):r.resolve(i)});for(var s=0;s<t.length;s++)t[s]()}var t=[],r=s.defer();t.push(e.$on("angularFireAuth:login",function(e,t){i(null,t)}));t.push(e.$on("angularFireAuth:error",function(e,t){i(t,null)}));return r.promise}}}]);